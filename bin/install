#!/usr/bin/env  bash

set -e
set -o pipefail

fail() {
  echo -e "\e[31mFail:\e[m $*"
  exit 1
}

# expects that asdf calls bin/download first
install_bats() {
  local install_path=$1
  local download_path=${2:-"/tmp/bats"}

  local work_dir
  work_dir="$(pwd)"

  echo "* Looking Bats from $download_path"

  (
    cd "$download_path"
    echo "* Installing Bats to $install_path"
    bash install.sh "$install_path"
    rm -rf "$download_path"
    cd "$work_dir"
  ) || (
    rm -rf "$install_path"
    fail "An error occured during installation"
  )
}

install_bats "$ASDF_INSTALL_PATH" "$ASDF_DOWNLOAD_PATH"
